<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noty/3.1.4/noty.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noty/3.1.4/noty.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>

    <link rel="stylesheet" href="/css/home.css">
    <title>
        <%= title %>
    </title>
    
</head>
<body>
    <h1> Codial / <%=title%></h1>
    <a href="/users/profile">profile</a>

    <!-- <% if(flash.success && flash.success.length > 0){ %>  we checking length >0 bcz it should not be an empty string
        <h5>
            <%=flash.success%>
        </h5>
    <% } %>  -->
    

    <header>
        <ul>
            <% if(locals.user){%>
                <li><%= user.name %></li>
                <li>
                    <a href="/users/sign-out">Sign Out</a>
                </li>
            <%}else{%>
                <li>
                    <a href="/users/sign-in">Sign in</a>
                </li>
                <li>
                    <a href="/users/sign-up">Sign up</a>
                </li>
            <% } %>
        </ul>
    </header>

    <div id="home-container">
        <section id="feed-posts">
            <h4>Posts</h4>
             <% if(locals.user){ %> <!--only the authenticated user should able to write comment, but it might possible that user can go in inspect and make changes in code so we should check authentication in controller -->
            <form action="/posts/create" id="new-post-form" method="post">
                <textarea name="content" id="" cols="30" rows="3" placeholder="Type here..."></textarea>
                <input type="submit" value="Post">
            </form>
            <%}%>
            <div id="posts-list-container">
                <ul>
                     <% for(post of posts){%> <!--how posts is accesable from here -->
                        <%-include('_post')-%>
                    <%}%>
                </ul>
            </div>
        </section>
        
        <section id="user-friend">
            <h4>Friends</h4><br>
            <% for(u of all_users){ %>
                <p>
                    <a href="/users/profile/<%= u.id %>"><%=u.name%></a>
                </p>
            <%}%>
        </section>
    </div>
    <%- include('_chat_box')-%>
    <script>
        <% if(flash.success && flash.success.length >0){ %>
            new Noty({
                theme:'relax',
                text:"<%= flash.success %>",
                type: 'success',
                layout:'topRight',
                timeout:1500
            }).show();
        <%}%>
        <% if(flash.error && flash.error.length >0){ %>
            new Noty({
                theme:'relax',
                text:"<%= flash.error %>",
                type: 'error',
                layout:'topRight',
                timeout:1500
            }).show();
        <%}%>
    </script>

    <script src="/js/home_posts.js"></script>
    <script src="/js/home_posts_comments.js"></script>

    <script src="js/toggle_likes.js"></script>
    <script>
        $('.toggle-like-button').each(function(){
            let self = this;
            let toggleLike = new ToggleLike(self);
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.1/socket.io.js"></script>
    <script src="js/chat_engine.js"></script>
    <% if(locals.user){ %> 
    <script>
        new ChatEngine('user-chat-box','<%= locals.user.email %>')
    </script>
    <%}%>
</body>
</html>